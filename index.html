<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Extending Umbraco Forms</title>

	<link rel="stylesheet" href="dist/reset.css">
	<link rel="stylesheet" href="dist/reveal.css">
	<link rel="stylesheet" href="dist/theme/truelime.css" />

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="plugin/highlight/monokai.css">
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section class="full-screen-slide" data-background-color="rgb(136,0,78)">
				<h1 class="r-fit-text">Extending<br /> Umbraco Forms</h1>
			</section>

			<section>
				<h2>Introduction</h2>
				<ul>
					<li>Dave Woestenborghs</li>
					<li>Work at <a href="https://truelime.nl/">Truelime</a></li>
					<li>Umbraco MVP (9x)</li>
					<li>Working with Umbraco since 2008</li>
					<li>Part of the 24 days in Umbraco team</li>
				</ul>
			</section>

			<section data-auto-animate>
				<h2>Umbraco Forms</h2>
				<p>First released around 2010 as <a
						href="https://our.umbraco.com/packages/umbraco-pro/contour/">Contour</a></p>
				<p class="fragment">Commercial add-on developed by Umbraco HQ</p>
				<p class="fragment">Rebranded to <a href="https://marketplace.umbraco.com/package/umbraco.forms">Umbraco
						Forms</a> around 2016</p>
			</section>

			<section data-auto-animate>
				<h2>Umbraco Forms</h2>
				<p>Allows website editors and developers to create and manage forms directly within the Umbraco
					environment, without needing to write custom code.</p>
			</section>

			<section data-auto-animate>
				<h2>Umbraco Forms</h2>
				<p>But it can be customized and extended.</p>
			</section>

			<section class="full-screen-slide" data-background-color="#e33f00">
				<h1 class="r-fit-text">Changing<br> default behavior</h1>
			</section>

			<section data-auto-animate>
				<h2>Form design</h2>
				<p>Configure default values for design and behavoir <a
						href="https://docs.umbraco.com/umbraco-forms/v/13.forms.latest-lts/developer/configuration#form-design-configuration">
						settings</a></p>

			</section>

			<section data-auto-animate>
				<h2>Form design</h2>
				<pre>
					<code data-trim data-noescape class="language-json">
						"Umbraco": {
							"Forms": {
								"FormDesign": {
									"MaxNumberOfColumnsInFormGroup": 12,
									"DefaultTheme": "default",
									"Defaults": {
										"DisableStylesheet": true,
										"AutocompleteAttribute": "off",
										"Indicator": "*",
										"MarkFieldsIndicator": "MarkMandatoryFields",
										"DaysToRetainApprovedRecordsFor": 90,
										"DaysToRetainRejectedRecordsFor": 90,
										"DaysToRetainSubmittedRecordsFor": 90
									}									
								}								
							}
						}
					</code>
				</pre>
			</section>

			<section data-auto-animate data-auto-animate-restart>
				<h2>Settings customization</h2>
				<p>Customize <a
						href="https://docs.umbraco.com/umbraco-forms/v/13.forms.latest-lts/developer/configuration#settingscustomization">settings</a>
					for <a
						href="https://docs.umbraco.com/umbraco-forms/v/13.forms.latest-lts/developer/configuration/type-details">provider
						types</a>
					<br /> (fields, workflows,..)
				</p>
			</section>

			<section data-auto-animate>
				<h2>Settings customization</h2>
				<p>Provide a default value</p>
				<p class="fragment">Read only mode</p>
				<p class="fragment">Hide the setting</p>
			</section>

			<section data-auto-animate>
				<h2>Settings customization</h2>
				<pre>
					<code data-trim data-noescape class="language-json">
						"Umbraco": {
							"Forms": {
								"FormDesign": {									
									"SettingsCustomization": {
										"FieldTypes": {
											"shortAnswer": {
												"AutocompleteAttribute": {
													"IsHidden": true,
													"DefaultValue": "off"
												}
											}
										}
									}
								}
							}
						}
					</code>
				</pre>
			</section>

			<section data-auto-animate data-auto-animate-restart>
				<h2>Default fields & workflows</h2>
				<p>Out of the box when creating a new form a consent field and a e-mail workflow are added, <br>but this can be changed</p>				
			</section>

			<section data-auto-animate>
				<h2>Default fields & workflows</h2>
				<p>For fields replace the implementation of the <a href="https://docs.umbraco.com/umbraco-forms/v/13.forms.latest-lts/developer/extending/customize-default-workflows#example-providing-a-custom-apply-fields-behavior">IApplyDefaultFieldsBehavior</a> interface</p>								
			</section>

			<section data-auto-animate>
				<h2>Default fields & workflows</h2>
				<p>For workflows replace the implementation of the <a href="https://docs.umbraco.com/umbraco-forms/v/13.forms.latest-lts/developer/extending/customize-default-workflows#example-providing-a-custom-apply-workflows-behavior">IApplyDefaultWorkflowsBehavior</a> interface</p>								
			</section>

			<section data-auto-animate>
				<h2>Default fields & workflows</h2>
				<pre>
					<code  data-line-numbers="1-2|14-15|16-22|24-28|30-39|42-44" data-trim data-noescape class="language-csharp">
public class ApplyDefaultFieldsBehavior : IApplyDefaultFieldsBehavior
{
    private readonly FormDesignSettings _formDesignSettings;
    private readonly FieldCollection _fieldCollection;

    public ApplyDefaultFieldsBehavior(
        IOptions<FormDesignSettings> formDesignSettings,
        FieldCollection fieldCollection)
    {
        this._formDesignSettings = formDesignSettings.Value;
        this._fieldCollection = fieldCollection;
    }

    public void ApplyDefaultFields(FormDesign form)
    {
        Page page = new Page();
        form.Pages.Add(page);
        FieldSet fieldSet = new FieldSet()
        {
            Id = Guid.NewGuid()
        };
        page.FieldSets.Add(fieldSet);

        FieldsetContainer container = new FieldsetContainer()
        {
            Width = 12
        };
        fieldSet.Containers.Add(container);

        var firstNameField = new Field
        {
            Alias = "firstName",
            Id = Guid.NewGuid(),
            FieldTypeId = Guid.Parse(Umbraco.Forms.Core.Constants.FieldTypes.Textfield),
            Mandatory = true,
            Caption = "First name"
        };

        container.Fields.Add(firstNameField);


        if (this._formDesignSettings.DisableAutomaticAdditionOfDataConsentField)
            return;
        container.AddDataConsentField(this._formDesignSettings, this._fieldCollection);
    }
}
					</code>
				</pre>								
			</section>

			<section data-auto-animate>
				<h2>Default fields & workflows</h2>
				<pre>
					<code  data-line-numbers="" data-trim data-noescape class="language-csharp">
						<script type="text/template">
							public class DefaultBehaviorComposer : IComposer
							{
								public void Compose(IUmbracoBuilder builder)
								{
									builder.Services.AddUnique<IApplyDefaultFieldsBehavior, ApplyDefaultFieldsBehavior>();
								}
							}
						</script>
					</code>
				</pre>								
			</section>

			<section data-background-video="/video/default-fields.mp4" data-background-size="contain" class="full-screen-slide"></section>

			<section data-auto-animate>
				<h2>Provider types</h2>
				<p>Out of the box all provider based types are  available <br>
					(fields, workflows, etc..) </p>
			</section>

			<section data-auto-animate>
				<h2>Provider types</h2>
				<img class="r-stretch" src="/img/workflows-before.png" />				
			</section>

			<section data-auto-animate>
				<h2>Provider types</h2>
				<p>Remove the ones you don't need</p>
			</section>

			<section data-auto-animate>
				<h2>Provider types</h2>
				<pre>
					<code  data-line-numbers="" data-trim data-noescape class="language-csharp">
						<script type="text/template">
public class ExcludeWorkflowTypesComposer : IComposer
{
	public void Compose(IUmbracoBuilder builder)
	{
		builder.FormsWorkflows()
			.Exclude<Slack>()
			.Exclude<SlackV2>()
			.Exclude<SendXsltEmail>()
			.Exclude<SaveAsUmbracoNode>()
			.Exclude<SaveAsFile>()
			.Exclude<PostAsXml>()
			.Exclude<PostToUrl>()
			.Exclude<SendEmail>();
	}
}
						</script>
					</code>
				</pre>								
			</section>

			<section data-auto-animate>
				<h2>Provider types</h2>
				<img class="r-stretch" src="/img/workflows-after.png" />				
			</section>

			<section class="full-screen-slide" data-background-color="#db0967">
				<h1 class="r-fit-text">Form validation</h1>
			</section>

			<section data-auto-animate>
				<h2>Form validation</h2>
				<p>Fields can be marked as mandatory</p>
				<p class="fragment">A regular expression can be applied for format validation</p>
				<p class="fragment">Validation happens client and server side.</p>				
			</section>
			<section data-auto-animate>
				<h2>Form validation</h2>
				<p>Regular expression can be selected from a predefined list or entered manually</p>
				<img class="r-stretch" src="/img/validation-before.png" />
			</section>

			<section data-auto-animate data-auto-animate-restart="">
				<h2>Custom validation patterns</h2>
				<p>The predefined list can be extended with additional <a href="https://docs.umbraco.com/umbraco-forms/v/13.forms.latest-lts/developer/extending/adding-a-validation-pattern">validation patterns</a>
				by registering a class that implements the IValidationPattern interface</p>							
			</section>

			<section data-auto-animate>
				<h2>Custom validation patterns</h2>
				<pre>
					<code  data-line-numbers="" data-trim data-noescape class="language-csharp">
						<script type="text/template">
							public class DutchIbanPattern : IValidationPattern
							{
								public string Alias => "dutchIbanPattern";
								// as an alternative to providing a name, a translation key can be provided.
								// This will be used to look-up the name in the correct language for the backoffice user.
								public string LabelKey => string.Empty;
								public string Name => "Dutch IBAN Number";
								public string Pattern => "^NL[0-9]{2}[A-Z]{4}[0-9]{10}$";
								public bool ReadOnly => true;
							}
						</script>
					</code>
				</pre>								
			</section>

			<section data-auto-animate>
				<h2>Custom validation patterns</h2>
				<pre>
					<code  data-line-numbers="" data-trim data-noescape class="language-csharp">
						<script type="text/template">
public class AddValidationPatternsComposer : IComposer
{
	public void Compose(IUmbracoBuilder builder)
	{
		builder.FormsValidationPatterns().Append<DutchIbanPattern>();
	}
}
						</script>
					</code>
				</pre>								
			</section>

			<section data-auto-animate>
				<h2>Custom validation patterns</h2>				
				<img class="r-stretch" src="/img/validation-after.png" />
			</section>
		</div>
	</div>

	<div id="tl-logo" class="hide-logo">
		<a href="https://www.truelime.nl/">
			<img src="img/logo.svg" width="200" />
		</a>
	</div>


	<script src="dist/reveal.js"></script>
	<script src="plugin/notes/notes.js"></script>
	<script src="plugin/markdown/markdown.js"></script>
	<script src="plugin/highlight/highlight.js"></script>
	<!-- <script src="plugin/highlight/cshtml-razor.min.js"></script> -->
	<script src="plugin/zoom/zoom.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,

			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom],
			width: 1200,
			height: 700,
			transition: 'convex'
		});

		Reveal.on('slidechanged', function (event) {
			var logo = document.querySelector('#tl-logo');

			if (event.currentSlide.classList.contains('full-screen-slide')) {
				logo.classList.add('hide-logo');
			}
			else {
				logo.classList.remove('hide-logo');
			}
		});
	</script>
</body>

</html>